<!DOCTYPE html><html lang=zh-CN><head hexo-theme=https://github.com/volantis-x/hexo-theme-volantis/tree/4.3.1><meta charset=utf-8><meta http-equiv=x-dns-prefetch-control content=on><link rel=dns-prefetch href=https://cdn.jsdelivr.net><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><meta name=renderer content=webkit><meta name=force-rendering content=webkit><meta http-equiv=X-UA-Compatible content="IE=Edge,chrome=1"><meta name=HandheldFriendly content=True><meta name=apple-mobile-web-app-capable content=yes><meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1"><link rel=preload href=/css/first.css as=style><title>PM技术课 _ 搜索引擎知多少？ - 小冰 RSSHub</title><link rel=alternate href=/atom.xml title="小冰 RSSHub" type=application/atom+xml><meta name=referrer content=no-referrer><link rel=stylesheet href=/css/diy.css><link rel=stylesheet href=/css/first.css><link rel=stylesheet href=/css/style.css media=print onload="this.media='all';this.onload=null"><noscript><link rel=stylesheet href=/css/style.css></noscript><script id=loadcss></script><script>
if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode))
    document.write(
	'<style>'+
		'html{'+
			'overflow-x: hidden !important;'+
			'overflow-y: hidden !important;'+
		'}'+
		'.kill-ie{'+
			'text-align:center;'+
			'height: 100%;'+
			'margin-top: 15%;'+
			'margin-bottom: 5500%;'+
		'}'+
	'</style>'+
    '<div class="kill-ie">'+
        '<h1><b>抱歉，您的浏览器无法访问本站</b></h1>'+
        '<h3>微软已经于2016年终止了对 Internet Explorer (IE) 10 及更早版本的支持，<br/>'+
        '继续使用存在极大的安全隐患，请使用当代主流的浏览器进行访问。</h3><br/>'+
        '<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/WindowsForBusiness/End-of-IE-support"><strong>了解详情 ></strong></a>'+
    '</div>');
</script><noscript><style>
		html{
			overflow-x: hidden !important;
			overflow-y: hidden !important;
		}
		.kill-noscript{
			text-align:center;
			height: 100%;
			margin-top: 15%;
			margin-bottom: 5500%;
		}
	</style><div class=kill-noscript><h1><b>抱歉，您的浏览器无法访问本站</b></h1><h3>本页面需要浏览器支持（启用）JavaScript</h3><br><a target=_blank rel=noopener href="https://www.baidu.com/s?wd=启用JavaScript"><strong>了解详情 ></strong></a></div></noscript></head><body><header id=l_header class="l_header always shadow blur show"><div class=container><div id=wrapper><div class=nav-sub><p class=title></p><ul class="switcher nav-list-h m-phone" id=pjax-header-nav-list><li><a id=s-comment class="fas fa-comments fa-fw" target=_self href=javascript:void(0)></a></li><li><a id=s-toc class="s-toc fas fa-list fa-fw" target=_self href=javascript:void(0)></a></li></ul></div><div class=nav-main><a class="title flat-box" target=_self href="/"><img no-lazy class=logo src=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/Logo-NavBar@3x.png></a><div class="menu navigation"><ul class="nav-list-h m-pc"><li><a class="menuitem flat-box faa-parent animated-hover" href="/" id=home><i class="fas fa-home fa-fw fa-fw"></i> 主页</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%8D%9A%E5%AE%A2/" id=categoriesE58D9AE5AEA2><i class="fas fa-rss fa-fw"></i> 博客订阅</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E6%96%B0%E5%AA%92%E4%BD%93/" id=categoriesE696B0E5AA92E4BD93><i class="fas fa-podcast fa-fw fa-fw"></i> 新媒体</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E4%BA%8C%E6%AC%A1%E5%85%83/" id=categoriesE4BA8CE6ACA1E58583><i class="fas fa-heart fa-fw fa-fw"></i> 二次元</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E6%B8%B8%E6%88%8F/" id=categoriesE6B8B8E6888F><i class="fa fa-gamepad fa-fw fa-fw"></i> 游戏</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%9B%BE%E7%89%87/" id=categoriesE59BBEE78987><i class="fas fa-puzzle-piece fa-fw fa-fw"></i> 图片</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E8%AE%BE%E8%AE%A1/" id=categoriesE8AEBEE8AEA1><i class="fas fa-magic fa-fw fa-fw"></i> 设计</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E7%BC%96%E7%A8%8B/" id=categoriesE7BC96E7A88B><i class="fas fa-code fa-fw fa-fw"></i> 编程</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E9%87%91%E8%9E%8D/" id=categoriesE98791E89E8D><i class="fas fa-key fa-fw fa-fw"></i> 金融</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E7%A4%BE%E4%BA%A4%E5%AA%92%E4%BD%93/" id=categoriesE7A4BEE4BAA4E5AA92E4BD93><i class="fas fa-users fa-fw fa-fw"></i> 社交媒体</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E9%98%85%E8%AF%BB/" id=categoriesE99885E8AFBB><i class="fas fa-book fa-fw fa-fw"></i> 阅读</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%AD%A6%E4%B9%A0/" id=categoriesE5ADA6E4B9A0><i class="fas fa-graduation-cap fa-fw fa-fw"></i> 学习</a></li></ul></div><div class=m_search><form name=searchform class="form u-search-form"><i class="icon fas fa-search fa-fw"></i> <input type=text class="input u-search-input" placeholder=Search...></form></div><ul class="switcher nav-list-h m-phone"><li><a class="s-search fas fa-search fa-fw" target=_self href=javascript:void(0)></a></li><li><a class="s-menu fas fa-bars fa-fw" target=_self href=javascript:void(0)></a><ul class="menu-phone list-v navigation white-box"><li><a class="menuitem flat-box faa-parent animated-hover" href="/" id=home><i class="fas fa-home fa-fw fa-fw"></i> 主页</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%8D%9A%E5%AE%A2/" id=categoriesE58D9AE5AEA2><i class="fas fa-rss fa-fw"></i> 博客订阅</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E6%96%B0%E5%AA%92%E4%BD%93/" id=categoriesE696B0E5AA92E4BD93><i class="fas fa-podcast fa-fw fa-fw"></i> 新媒体</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E4%BA%8C%E6%AC%A1%E5%85%83/" id=categoriesE4BA8CE6ACA1E58583><i class="fas fa-heart fa-fw fa-fw"></i> 二次元</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E6%B8%B8%E6%88%8F/" id=categoriesE6B8B8E6888F><i class="fa fa-gamepad fa-fw fa-fw"></i> 游戏</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%9B%BE%E7%89%87/" id=categoriesE59BBEE78987><i class="fas fa-puzzle-piece fa-fw fa-fw"></i> 图片</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E8%AE%BE%E8%AE%A1/" id=categoriesE8AEBEE8AEA1><i class="fas fa-magic fa-fw fa-fw"></i> 设计</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E7%BC%96%E7%A8%8B/" id=categoriesE7BC96E7A88B><i class="fas fa-code fa-fw fa-fw"></i> 编程</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E9%87%91%E8%9E%8D/" id=categoriesE98791E89E8D><i class="fas fa-key fa-fw fa-fw"></i> 金融</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E7%A4%BE%E4%BA%A4%E5%AA%92%E4%BD%93/" id=categoriesE7A4BEE4BAA4E5AA92E4BD93><i class="fas fa-users fa-fw fa-fw"></i> 社交媒体</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E9%98%85%E8%AF%BB/" id=categoriesE99885E8AFBB><i class="fas fa-book fa-fw fa-fw"></i> 阅读</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%AD%A6%E4%B9%A0/" id=categoriesE5ADA6E4B9A0><i class="fas fa-graduation-cap fa-fw fa-fw"></i> 学习</a></li></ul></li></ul></div></div></div></header><div id=l_body><div id=l_cover><div id=full class="cover-wrapper post dock" style="display: none;"><div class="cover-bg lazyload placeholder" data-bg="https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPicture"></div><div class=cover-body><div class=top><p class=title>Volantis</p></div><div class=bottom><div class="menu navigation"><div class=list-h><a href="/v4/getting-started/" id=v4getting-started><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f5c3.svg><p>文档</p></a> <a href="/faqs/" id=faqs><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f516.svg><p>帮助</p></a> <a href="/examples/" id=examples><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f396.svg><p>示例</p></a> <a href="/contributors/" id=contributors><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f389.svg><p>社区</p></a> <a href="/archives/" id=archives><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4f0.svg><p>博客</p></a> <a target=_blank rel=noopener href="https://github.com/volantis-x/hexo-theme-volantis/" id=https:githubcomvolantis-xhexo-theme-volantis><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f9ec.svg><p>源码</p></a></div></div></div></div><div id=scroll-down style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div></div></div><div id=safearea><div class=body-wrapper id=pjax-container><div class=l_main><article class="article post white-box reveal md shadow article-type-post" id=post itemscope itemprop=blogPost><div class=headimg-div><a class=headimg-a><img class=headimg src=https://image.woshipm.com/wp-files/2019/03/gs7yWWmhheVR2CCfCyBg.jpg></a></div><div class=article-meta id=top><a title="PM技术课 _ 搜索引擎知多少？" href=/p/ed42.html><img class=thumbnail src=https://image.woshipm.com/wp-files/2019/03/gs7yWWmhheVR2CCfCyBg.jpg></a><h1 class=title>PM技术课 _ 搜索引擎知多少？</h1><div class=new-meta-box><div class="new-meta-item author"><a class=author target=_blank href="https://docs.rsshub.app/" rel="nofollow noopener"><img no-lazy src=https://i.loli.net/2019/04/23/5cbeb7e41414c.png><p>RSSHub</p></a></div><div class="new-meta-item category"><a class=notlink><i class="fas fa-folder-open fa-fw" aria-hidden=true></i> <a class=category-link href="/categories/%E6%96%B0%E5%AA%92%E4%BD%93/">新媒体</a><span class=sep></span><a class=category-link href="/categories/%E6%96%B0%E5%AA%92%E4%BD%93/%E4%BA%BA%E4%BA%BA%E9%83%BD%E6%98%AF%E4%BA%A7%E5%93%81%E7%BB%8F%E7%90%86/">人人都是产品经理</a><span class=sep></span><a class=category-link href="/categories/%E6%96%B0%E5%AA%92%E4%BD%93/%E4%BA%BA%E4%BA%BA%E9%83%BD%E6%98%AF%E4%BA%A7%E5%93%81%E7%BB%8F%E7%90%86/%E7%94%A8%E6%88%B7%E6%94%B6%E8%97%8F/">用户收藏</a></a></div><div class="new-meta-item date"><a class=notlink><i class="fas fa-calendar-alt fa-fw" aria-hidden=true></i><p>发布于：2019年3月16日</p></a></div><div class="new-meta-item browse leancloud"><a class=notlink><div id=lc-pv data-title="PM技术课 _ 搜索引擎知多少？" data-path=/p/ed42.html><i class="fas fa-eye fa-fw" aria-hidden=true></i><span id=number><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden=true></i></span> 次浏览</div></a></div></div></div><div><blockquote><p>“搜索”在这个数据信息冗杂的时代里，充当着人们信息的筛选器，人们通过使用搜索功能，可以获得自己想要的内容，屏蔽掉无用的信息。对于商家来说，理论上，搜索功能在一定程度上可以增加长尾信息的曝光度。但是，总所周知，搜索引擎的排序规则实际上饱含水分，竞价排名的规则下，长尾信息的曝光可能就打水漂了。所以，无论是C端还是B端的产品经理，深谙搜索引擎规则，并学会利用好搜索引擎都非常重要。</p></blockquote><p><img data-action=zoom class="size-full wp-image-2080166 aligncenter lazyload" src=https://image.woshipm.com/wp-files/2019/03/gs7yWWmhheVR2CCfCyBg.jpg data-srcset=https://image.woshipm.com/wp-files/2019/03/gs7yWWmhheVR2CCfCyBg.jpg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" width=800 height=450 referrerpolicy=no-referrer></p><h2 id=toc-1>一、 初识搜索引擎</h2><h3>1. 搜索引擎简史</h3><p>提及搜索引擎，大家脑海中就会浮现起国内的百度和国外的Google，我们想要查找什么资料，直接在搜索框中输入关键字，点击搜索按钮，之后就会展现搜索结果。</p><p><img data-action=zoom class="content_image aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/bfB4ke0Z4hYPQqfsONTc.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/bfB4ke0Z4hYPQqfsONTc.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=417 referrerpolicy=no-referrer></p><p>其实这只是搜索引擎的一部分，我们使用微博搜索某个明星，使用淘宝搜索商品，使用豆瓣搜索一本书，都是搜索引擎。这些搜索引擎因为太常用，我们反而没有意识到。</p><p><b>搜索引擎本质上是一种信息获取方式。</b></p><p>搜索引擎主要经历了：<b>分类目录、相关性搜索、高质量搜索、个性化搜索</b>四个阶段。</p><p>在搜索引擎诞生前，我们使用分类目录来获取信息。Yahoo!和国内hao123是分类目录的代表。当时信息相对较少，通过人工整理，把属于各个类别的高质量网站罗列出来，比如：按照财经类、新闻类、体育类、游戏类等项目进行整理，用户可以通过分类目录来查找需要的信息。</p><p>但一个页面的展示空间有限，分类目录也只能收录少数的网站，绝大多数网站都无法被收录，而那些没有被收录的信息，可能正是大家需要的。</p><p>有需求，就有商机，搜索引擎顺势而生。</p><p>最早的搜索引擎，通过查找用户输入的关键词与网页信息的匹配程度，也就是计算两者的相关性，展示网页列表，至于如何计算匹配程度，会在后文讲解。</p><p>相比分类目录，这种方式可以收录大量的网页，并按照用户查询的关键词和网页内容的匹配程度进行排序。</p><p>但这种方式有个巨大的问题：只考虑了相关性，没有考虑网页的质量。网页可以通过大量罗列跟内容无关的关键词，来提高与关键词的相关性。</p><p>比如：一家做教育的网站，可能会罗列明星、宠物、新闻甚至色情等高流量词语，这种“强行蹭流量”的方式，造成的后果就是搜索结果质量并不好。</p><p>解决这个问题的是Google，Google假设网页的链接越多，网站质量越高。利用网页之间的链接数量来确定网页质量，一个网页的链接数量越多，说明在网页在整个互联网中质量越高，Google的核心算法，也会在后文讲述。</p><p>发展到现在，搜索引擎不仅需要解决相关性和质量的问题，还要更多考虑用户的真实需求，比如：同样输入“苹果”，年轻人可能想的是手机，另外一些人想到的是水果。这就需要更加复杂的算法和程序了。</p><h2 id=toc-2>二、什么是好的搜索引擎</h2><p>从分类目录、相关性搜索、高质量搜索、个性化搜索，我们可以从搜索引擎的发展阶段看出，搜索引擎越来越复杂，用户体验也更好了。</p><p>那么，如果判断一个搜索引擎好不好呢？</p><p>主要有三个评价标准：</p><h3>1. 好的搜索引擎要快</h3><p>速度是用户对搜索引擎的第一个印象。</p><p>当用户搜索一件商品，几十秒还没有搜索到，他可能去干其他事情了，就直接放弃购买了！商用搜索引擎的查询速度要达到毫秒级，一眨眼的功夫，搜索结果就出来了，用户体验就很好。</p><p>影响搜索速度的因素有很多，索引是最关键的因素之一，关于索引，会在下一节详细介绍。</p><h3>2. 要查的准</h3><p>当用户翻了3页还找不到想要的内容，干脆就不找了。</p><p>影响查询准确率的因素同样有很多，主要有下面这三个：</p><ol><li>搜索引擎本身存储的信息要全，对于百度等商用搜索引擎，这就要求爬虫能够爬取全网内容。</li><li>关键词和网页内容的相关性要高，用户搜索手机，结果有很多单反相机，就不太好了。</li><li>网页信息质量要高，Google发明的PageRank算法很巧妙地解决了这个问题。</li></ol><h3>3. 搜索引擎要具有稳定性</h3><p>这也是用户对大多数产品的要求，给用户一个合理的预期，用户才能够信任这款产品，三天两头不能用了，体验就差极了。</p><p><b>搜索引擎是怎么工作的？</b></p><p>那么，搜索引擎到底是如何工作的呢？</p><p><img data-action=zoom class="origin_image zh-lightbox-thumb aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/0Yte3gBDZmKo4Pt3bpiy.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/0Yte3gBDZmKo4Pt3bpiy.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=519 referrerpolicy=no-referrer></p><p>一个最基本的搜索引擎主要分为:<b>信息获取、信息处理、信息展示</b>三个模块。</p><p>巧妇难为无米之炊，信息获取是整个系统的基石。对商用搜索引擎而言，要求爬虫能够爬取全网内容，关于爬虫，我们再上一章已经介绍过了，这里就不再赘述。对网站内部搜索引擎而言，也需要把信息汇总起来，比如：电商平台，就需要把所有的产品信息存储到一起。</p><p>信息处理主要是对原始数据清洗，存入数据库，这里最重要的一个环节就是构建索引，相当于给每一个内容添加目录，便于查找。</p><p>信息展示指搜索引擎根据用户的查询词（query）来进行数据库检索，将结果展示给用户，主要涉及到用户查询内容与网页内容的相关性分析、网页质量评价等技术。</p><p>虽然搜索引擎具体实现方式有差异，但所有的搜索服务都可以在这三个模块的基础上实现。</p><h2 id=toc-3>三、内容索引</h2><p><b>搜索引擎为什么这么快？</b></p><p>好的搜索引擎的评价标准之一就是要快，那么搜索引擎是如何实现的呢？</p><p>在开始讲解之前，我们可以考虑另外一个相似的问题：如何在图书馆找到一本书？</p><p>最笨的方法是一个书架、一个书架地找，这会花费大量的时间。</p><p>聪明一些的方式是通过索书号，快速找到所在书架，进而找到这本书。</p><p>搜索引擎中的索引就相当于图书馆里每本书的索书号，通过索引，可以快速找到需要的信息。</p><p><strong>索引到底长啥样？</strong></p><p>以网页搜索引擎为例：下面这张图是一个简单的索引系统（更准确的说法是倒排索引，至于为什么是倒排，这里先卖个小关子，后面会讲到）。</p><p>左边是关键词，右边是这个关键词出现在哪个网页中，一个关键词可能同时出现在很多网页中，所以是一对多的关系。</p><p><img data-action=zoom class="origin_image zh-lightbox-thumb aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/SVsdQEjAjqSOv0Ihwllm.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/SVsdQEjAjqSOv0Ihwllm.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=579 referrerpolicy=no-referrer></p><p>与图书馆索引不同是：一个图书馆再大，藏书毕竟还有有限的，图书管理员可以手工给每个图书建立索书号。但搜索引擎存储的数据都是以亿计算的，不可能手工建立索引，只能借助一些技术手段。</p><p>从上面的表格我们可以看出，构建索引主要有两个过程：查找关键词，把关键词和网页对应起来。</p><h3>关键词</h3><p>构建索引的前提是提取出关键词，那么给定一个文本（也就是网页的文字内容），如何获取里面的关键词呢？</p><p>主要有两步：首先是获得文本里出现的所有词语，也叫做分词，之后再从中筛选一些作为关键词。</p><p><b>第一步，分词。</b></p><p>如果是一句英文，“Marry had a little lamb”，每个词都是用空格分开的，里面有“marry”、“had”、“a”’、“little”、“lamb”这五个单词，但中文“玛丽有一只小绵羊”，因为没有分隔符（比如：空格）把每个词语分开，就有些麻烦了。</p><p>最容易想到的分词方法就是查字典，把句子从左到右看一遍（程序员的说法叫做遍历），每个词语如果在字典中出现过就标记出来。</p><p>拿“玛丽有一只小绵羊”举例，比如：“玛丽”这个词在字典中出现过，就把“玛丽”作为一个词语，“有”在词典中出现过，就把“有”作为一个词语，就这样一直做下去，最后可以分为“玛丽、有、一只、小绵羊”。</p><p>这种最简单的方式可以解决一部分问题，但也有很大的问题，比如是“小”“绵羊”还是作为整体的“小绵羊”呢？</p><p>程序员使用统计学解决这个问题：</p><p><img data-action=zoom class="content_image aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/YyNWR4wJqGB1qgWsqJWP.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/YyNWR4wJqGB1qgWsqJWP.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=354 referrerpolicy=no-referrer></p><p>从形式上看，词是字的组合，两个字组合在一起可能是一个词语，也可能不是，如果是词语的可能性（概率）大一些，我们就倾向于认为它们可以组成词语。</p><p>这就像：天气预报说明天下雨的概率70%，不下雨的概率30%，我们就倾向于认为明天下雨。“小绵羊”一起出现的概率是70%，分开出现的概率是30%，我们就倾向于认为“小绵羊”是一个词语。</p><p>那么，如何计算相邻的字组成词语的概率呢？</p><p>我们可以对语料库中相邻出现的各个字的组合的次数进行统计，计算所有的字相邻出现的频率，当语料库足够大时，出现的频率越高，对应的概率也就越高。</p><p>我们可以计算一个句子中所有组合出现的概率，产生最大的概率组合，就是分词的结果。</p><p>比如：“玛丽、有、一只、小绵羊”每一个词语出现的概率就大于“玛丽、有一、只、小、绵羊”等其他组合出现的概率，那么，我们就认为这个句子就按照“玛丽、有、一只、小绵羊”划分。</p><p><img data-action=zoom class="origin_image zh-lightbox-thumb aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/mhHBf5p3FvnU5lv7s0gc.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/mhHBf5p3FvnU5lv7s0gc.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=411 height=185 referrerpolicy=no-referrer></p><p><b>第二步，获得关键词。</b></p><p>对所有的文本分词之后会发现，“的”、“了”、“吗”、“也许”等没有很强实际意义的功能词有很多，相比之下“产品经理”、“搜索引擎”等词语更加具有实际意义的反而较少，后者更应该作为关键词。</p><p>于是，我们使用把所有这些功能词存起来，作为停用词（stop word），如果一个词语出现在停用词中，就不能作为关键词。于是，我们就从分词结果中，获得了关键词。</p><p>下面是一个简单的停用词表，可能看出，基本都是我们经常使用的、没有很强实际意义的词语。</p><p><img data-action=zoom class="origin_image zh-lightbox-thumb aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/urXzdbqG8yc0MScOOZ27.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/urXzdbqG8yc0MScOOZ27.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=554 referrerpolicy=no-referrer></p><p>中文分词是几乎所有中文自然语言处理（Natural Language Processing）的基础，所以学术界和产业界对中文分词的技术研究已经很深入了，有高质量的商用分词库，也有像jieba这样的开源中文分词库，可以免费使用。</p><p>通过提取每个网页的关键词，最终每个网页和关键词的对应关系如下：</p><p><img data-action=zoom class="origin_image zh-lightbox-thumb aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/FEZspFevMfXP6tbQwGyU.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/FEZspFevMfXP6tbQwGyU.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=472 height=264 referrerpolicy=no-referrer></p><p>需要注意的是：获取关键词不仅用在网页处理，而且也用在输入搜索框中。当我们搜索一句中文的时候，搜索引擎内部会进行分词、去掉停用词，获得关键词，之后再进行后续处理。</p><h3>倒排索引</h3><p>现在，我们已经建立好了索引，对于每一个网页，我们找到了出现的所有关键词。</p><p>当用户查询时，我们从头到尾，对每一篇文件扫描一遍，看哪个网页出现了用户查询的关键词，就把这个文件作为搜索结果。</p><p>但问题是：动辄上亿的网页数量，从头到尾扫描一次就要花好长时间，根本无法满足正常的需求，更别说快速响应了。</p><p>那我们能不能把关键词放前面，网页放后面？</p><p>这样，当我们检索的关键词的时候，不需要遍历整个系统，只用查找对应的几个关键词，就可以找到需要的网页了！</p><p><img data-action=zoom class="origin_image zh-lightbox-thumb aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/2yhkRgTlnbzmHJVmloaQ.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/2yhkRgTlnbzmHJVmloaQ.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=445 height=257 referrerpolicy=no-referrer></p><p>对计算机而言，直接寻找关键词所在位置的信息，所需的时间非常短，完全可以满足搜索的需要。</p><p>比如：用户搜索“关键词1”，那么搜索引擎只需要找到“关键词1”，就可以会直接找到“网页1，网页2，网页5，……网页L”。<br><img data-action=zoom class="origin_image zh-lightbox-thumb aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/Gq5KgCXLvKGI1m1Nc3I6.png data-srcset=https://image.woshipm.com/wp-files/2019/03/Gq5KgCXLvKGI1m1Nc3I6.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=488 height=73 referrerpolicy=no-referrer></p><p>用户搜索“关键词1+关键词2”，那么搜索引擎需要找到“网页1，网页2，网页5，……网页L”，“网页3，网页4，网页5，……网页M”，找到同时出现的“网页3、网页5，……”。这样就大大加快了呈现排名的速度。</p><p><img data-action=zoom class="origin_image zh-lightbox-thumb aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/q3aL9adjNMbnFhkAObdl.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/q3aL9adjNMbnFhkAObdl.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=495 height=172 referrerpolicy=no-referrer></p><p>把“文件-关键词”这种结构颠倒一下，“关键词-文件”，就是倒排索引名字的由来。</p><p>更进一步，倒排索引中不仅仅记录了包含网页的ID，还会记录关键词出现的频率（term frequency）、每个关键词对应的文档频率（inverse document frequency），以及关键词出现在文件中的位置等信息，这些信息可以直接用在搜索结果排序上。</p><h2 id=toc-4>四、搜索结果排序</h2><p>至此，我们通过爬虫实现了信息获取、通过倒排索引实现了信息处理，接下来就是如何把这些信息展示给用户，其中最关键的是如何排序。</p><p>对电商而言，用户可以选择按照销量、信用、价格甚至综合排序，当然， 排序中也会穿插一些推广。</p><p><img data-action=zoom class="content_image aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/lxZsTwGr1JfP8ipc12b2.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/lxZsTwGr1JfP8ipc12b2.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=278 referrerpolicy=no-referrer></p><p>对通用的搜索引擎而言，比如：百度，没有销量、评分这些选项，主要根据网页与搜索关键词的相关性、网页质量等排序。</p><h3>TF-IDF模型</h3><p>如何确定网页与关键词的到底有多大的相关性？</p><p>如果一个网页中关键词的出现很多次的话，我们通常会认为这个网页与搜索的关键词更匹配，搜索结果应该更靠前。</p><p>我们用词频(Term Frequency, TF)表示关键词在一篇文章中出现的频率，代表网页和关键词的匹配程度。</p><p><img data-action=zoom class="content_image aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/l9JZAyrUpoZh0NFKtUtd.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/l9JZAyrUpoZh0NFKtUtd.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=328 referrerpolicy=no-referrer></p><p>比如：我们在百度等搜索引擎上搜索“产品经理的工作”，关键词为“产品经理”，“工作”，“的”作为停用词，不出现在关键词中。</p><p>在某一个网页上，总共有1000个词，其中“产品经理”出现了5次，“工作”出现了10次，“产品经理”的词频就是0.005，“工作”的词频就是0.01，两者相加，0.015就是这个网页和“产品经理的工作”的词频。</p><p>这里有一个问题，相较“产品经理”，“工作” 这个词用的更多，在所有的网页中出现的概率也很高。搜索者可能希望查找产品经理相关的信息，按照TF排序，一些出现很多次“工作”这个关键字的网站，就可能排在前面，比如：《程序员的工作》、《老板的工作》等等，逆文本频率 (Inverse Document Frequency，IDF)应运而生。</p><p>文件频率（Document Frequency）可以理解为关键词在所有网页中出现的频率，如果一个关键词在很多网页中都出现过，那么它的文件频率就很高。反之亦然，比如：“工作”的DF就高于“产品经理”。</p><p>文件频率越高，这个词就越通用，有效的信息就越少，重要性应该更低。于是，我们把文件频率取个倒数，就形成了逆文本频率。</p><p>二八定律在这里同样适用，20%的常用词占用了80%的篇幅，大多数关键词出现的频率都很低，这就造成了文件频率很小，而逆文本频率很大，不便于处理。于是我们取对数，便于计算（当然，这里也有其他数学和信息论上的考虑）。</p><p><img data-action=zoom class="content_image aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/pDdzC1BtoYLuivzTP8Jb.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/pDdzC1BtoYLuivzTP8Jb.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=392 referrerpolicy=no-referrer></p><p>把词频(TF)、逆文档频率 (IDF)相乘，就是大名鼎鼎的TF-IDF模型了。</p><p>一个关键词在一个网页中出现的频率越高，这个关键词越重要，排名越靠前；在所有网页中出现的频率越高，这个关键词告诉我们的信息越少，排名应该更靠后。</p><p><img data-action=zoom class="content_image aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/IIchZWoVuaSlPjcBnfhD.png data-srcset=https://image.woshipm.com/wp-files/2019/03/IIchZWoVuaSlPjcBnfhD.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=383 referrerpolicy=no-referrer></p><p>TF-IDF模型帮助我们解决了关键词与网页相关性的计算，仅仅使用TF-IDF模型，也可以搭建出效果不错的搜索引擎。</p><p>当然，商用搜索引擎在TF-IDF的基础上，进行的一定的改进，比如：出现在文章开头和结尾的关键词更加重要，会根据词出现的位置调整相关度。但还是基于TF-IDF模型的调整。</p><h3>大名鼎鼎的PageRank</h3><p>搜索结果排序，仅仅考虑相关性，搜索的结果并不是很好。总有某些网页来回地倒腾某些关键词，使自己的搜索排名靠前（当然，部分原因也来自某些搜索引擎更加喜欢推荐自家的东西，这个就不属于技术问题了）。</p><p>引入网页质量，可以解决这个问题。排序的时候，不仅仅考虑相关性，还要考虑网页质量的高低，把质量高的网页放在前面，质量低的放在后面。</p><p>那么，如何判断网页质量呢？</p><p>解决这个问题的是两位Google的创始人。搜索引擎诞生之初，还是美国斯坦福大学研究生的佩奇 (Larry Page) 和布林 (Sergey Brin) 开始了对网页排序问题的研究。</p><p>他们的借鉴了学术界评判学术论文重要性的通用方法，看论文的引用次数，引用的次数越高，论文的质量也就越高。他们想到网页的重要性也可以根据这种方法来评价。</p><p>佩奇和布林使用PageRank值表示每个网页的质量，其核心思想其实非常简单，只有两条：</p><ol><li>如果一个网页有越多的链接指向它，说明这个网页质量越高，PageRank值越高，排名应该越靠前；</li><li>排名靠前的网页应该有更大的表决权，当一个网页被排名靠前的网页链接时，PageRank值也越高，排名也更靠前。</li></ol><p>我们做一个类比：</p><ol><li>有一个程序员，如果公司的人都夸他编程技术高，那么我们认为他编程技术高；</li><li>如果他被公司的CTO赏识，我们基本可以确定他的编程水平确实牛。</li></ol><p>比如：下面这张图（专业术语叫做拓扑图），每一个节点都是一个网页，每条线都是两个网站之间的链接。</p><p>链接越多，说明网站质量越高，相应的PageRank值就越高。</p><p><img data-action=zoom class="content_image aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/k5JJxnB6lsvrhQD6O2eM.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/k5JJxnB6lsvrhQD6O2eM.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=314 referrerpolicy=no-referrer></p><p>这里有个问题：“当一个网页被排名靠前的网页链接时，其排名也应靠前”，一个网页的排名的过程需要用到排名的结果，这就变成了“先有鸡还是先有蛋”的问题了。</p><p>Google的两位创始人用数学解决了这个问题：</p><p>最开始的时候，假设搜索的网页具有相同的PageRank值；根据初始值，开始第一轮的计算，按照链接数量和每个网页的PageRank值重新计算每一个网页的PageRank值；按照上一轮的结果，按照链接数量和每个网页的PageRank值重新计算每一个网页的PageRank值……</p><p>这样计算下去，直至每个网页的PageRank值基本稳定。</p><p>你可能会好奇，这样要计算多少次？</p><p>佩奇在论文中指出：对网络中的3.22亿个链接进行递归计算，发现进行52次计算后可获得收敛稳定的PageRank值。</p><p>当然，PageRank实际运行起来比这个更加复杂，上亿个网页的PageRank值计算量非常大，一个服务器根本无法完成，需要多台服务器实现分布式计算了。为此，Google甚至开发出了并行计算工具MapReduce来实现PageRank的计算！</p><p>除了巨大的计算量，PageRank同样要面对作弊的问题。</p><p>开头我们谈到TF-DIF的弊端的时候讲到：总有某些网页来回地倒腾某些关键词，使自己的搜索排名靠前。</p><p>同样的，针对PageRank，也总有些网页来回地倒腾链接，使自己的搜索排名靠前。这就需要更多的算法，来识别这些“作弊”行为，我们在搜索引擎反作弊一节再来细讲。</p><h3>其他排序方式</h3><p>至此，使用TF-IDF计算网页与搜索内容的相关性，使用PageRank计算网页质量，可以很好地实现网页排序，一个基本的搜索引擎就搭建完成了。</p><p>商用搜索引擎在此基础上，还衍生了出其他的排名方式。</p><p><strong>竞价排名：</strong></p><p>比较著名的是百度推出的<b>竞价排名</b>（其实最开始做竞价排名的不是百度，但百度做得太“成功”，也至于大家都认为是百度发明了竞价排名），竞价排名按照按网站出价高低决定排名先后。</p><p>这种排名方式最大的优点是：可以帮助搜索引擎公司盈利。</p><p>最大的弊端是：无法保证出价高的网页的质量高，在医疗等特殊领域，有时甚至相反。</p><p>随着用户数据的积累，关键词和对应用户点击网页的行为数据也被搜索引擎记录下来了，搜索引擎可以根据用户的操作，不断改进自己的引擎。</p><p>时至今日，商用搜索引擎的底层技术都差不了太多，用户数据记录成为了竞争的关键因素，这也是百度得以在国内的搜索引擎市场独占鳌头的重要原因——用户越多，搜索越准确，搜索越准确，用户越多！</p><p><b>站内搜索：</b></p><p>百度、Google等通用搜索引擎要做很多工作，相比之下，站内搜索就简单很多——数据量少、也基本都是整理过的结构化数据，比如：豆瓣读书，搜索的时候直接检索自己的数据库就可以了。</p><p>虽然站内搜索的技术与通用搜索引擎有很多不一样的地方，但构建索引、相关性计算、质量计算、排序等流程基本一致。对于站内搜索的需求，同样存在开源的解决方案。</p><p>业界两个最流行的开源搜索引擎——Solr和ElasticSearch，它们运行速度快、效果好、可靠性高、可扩展，最关键的是免费，足以满足一般的商业需求。</p><p>对大多数公司而言，直接使用开源搜索引擎就可以了，不用重新造轮子，甚至，这些开源的解决方案比自己从头搭建的还更加稳定可靠。</p><h2 id=toc-5>五、 SEO与搜索引擎反作弊</h2><h3>SEO</h3><p>搜索引擎结果排名影响流量，流量影响利润，有利润的地方就有“商机”，SEO就是针对搜索引擎排名的“商机”。</p><p>SEO（Search Engine Optimization）中文为搜索引擎优化——即利用搜索引擎的规则提高网站在搜索结果的排名。</p><p>SEO优化通常有两种方式：一种是<b>网站内部优化</b>，一种是<b>外部优化</b>。</p><p>内部优化主要是优化网页内容，比如：提高关键词的数量，优化网页内部标签等。更有甚者，一些网页会使用非常小的字重复关键词，或者使用跟背景相同的颜色重复一些高流量词语，以实现较高的排名。</p><p>外部优化主要优化链接，比如：添加友情链接、论坛、贴吧、知道、百科等，这就产生了买卖链接的生意。</p><p>可以看出：SEO的优化基本针对的就是TF-IDF和PageRank的排序方式，“投其所好”提高自己的排名。</p><h3>搜索引擎反作弊</h3><p>从用户的角度讲：高质量的、相关的信息才是真正需要的。</p><p>一些网页凭借SEO优化获得较高排名，本身可能质量不高、相关性也比较弱，这对那些老老实实提供优质内容的网站也是不公平的。</p><p>长此以往，可能就会产生“<b>劣币驱逐良币</b>”，搜索引擎搜索到的优质内容不断减少。</p><p>从这个角度看，SEO就是针对搜索引擎的作弊，搜索引擎公司也不希望这样的事情发生——搜索不到需要的信息，用户也许直接就跑了！</p><p>Google诞生初期，就一直面对作弊与反作弊的问题。</p><p>在2001年，敏感的站主和SEO优化者发现：有些网站的Google排名一夜之间就一落千里，有的网站排名则大幅上升，这个现象几乎是每月一次。</p><p>后来，人们才知道，Google定期地更新它的反作弊算法，提高搜索质量，这给人的感觉就像跳舞一样，因此被SEO称为Google Dance。</p><p>那么，Google是如何反作弊的呢？</p><p>虽然各种作弊行为的方式各不相同，但目标一致，都是为了获得更高的排名，大体上还是有一定规律的。根据这些规律，搜索引擎常用的反作弊方式有两类：根据作弊特征的主动出击，建立“黑白名单”的被动防御。</p><p><b>首先，搜索引擎会根据作弊网站的特征主动出击。</b></p><p>就像我们总是能从人群中一眼看到长得最特殊的人一样，一个出现大量重复关键词网页、一个出现大量链接的网页和一个普通的网页，在搜索引擎看来是很不一样的。</p><p><img data-action=zoom class="origin_image zh-lightbox-thumb aligncenter lazyload" title=产品经理的技术课——搜索引擎 src=https://image.woshipm.com/wp-files/2019/03/c3QXYLs1d8AHFbUqbNO1.jpeg data-srcset=https://image.woshipm.com/wp-files/2019/03/c3QXYLs1d8AHFbUqbNO1.jpeg srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=产品经理的技术课——搜索引擎 width=495 height=178 referrerpolicy=no-referrer></p><p>通过计算网页的关键词数量特征、链接数量特征，可以很快发现那些“出格”的网站，搜索引擎就可以凭此调整排名。（前文所述的Google Dance就是根据作弊网站链接异常实现反作弊的。）</p><p><b>其次，搜索引擎也会建立“黑白名单”，作为防御手段。</b></p><p>搜索引擎会根据网站内容的质量、品牌、权威程度等信息建立一个白名单，比如：政府网站、一些大公司网站就在白名单中，这些网站的质量较高，排名也靠前，白名单链接的网站质量一般也会较高。</p><p>与之对应的是黑名单，主要包括那些作弊严重的网站——比如：堆叠关键词、买卖链接的网站。如果同一个网站链向了多个黑名单中的网站，就可以把其认定为作弊的网站，降低排名。</p><h3>猫鼠游戏</h3><p>《猫鼠游戏》梦工厂出品的一部电影，根据真实经历改编，讲述了FBI探员与擅长伪造文件的罪犯之间进行一场场猫抓老鼠的故事。在搜索引擎中，也同样存在这样的猫鼠游戏。</p><ul><li>为什么电商网站商品名称这么长？</li><li>为什么会好评返现？差评有偿删除？</li><li>为什么有些评价很高的宾馆/餐厅，实际却脏乱差？</li><li>为什么电影评价网站经常会因为刷好评/差评进入舆论中心？</li><li>为什么微博等社交媒体会有令人咂舌的阅读、点赞和转发数量？</li></ul><p>网站和商品本身的相关性和质量很难客观量化，根据关键词、销量、评价、点击、阅读量等较为客观的指标生成排序结果，甚至决定是否进入热搜榜、热销榜，仍然是当前搜索引擎的工作原理。</p><p>搜索引擎面对这些行为，也不断进化出新的应对策略。</p><p>面对刷单行为，平台经历了睁一只眼闭一只眼的无可奈何，到物流追踪、下单用户身份判断的演变，刷单成本也随之急剧上升，刷单行为虽然没有被杜绝，但也大幅下降。</p><p>面对阅读量、点击造假等方式，社交媒体也经历着从听之任之到屏蔽刷排名的转变，中间虽然有收入的降低、用户活跃度下降、大V流失的风险，但也终究要踏上这一步。</p><p>但，这场作弊与反作弊的猫鼠游戏，并没有终点。</p><p></p><p>本文由@linghu 原创发布于人人都是产品经理，未经许可，禁止转载</p><p>题图来自Unsplash, 基于CC0协议</p><div class=support-author><div class=support-title>给作者打赏，鼓励TA抓紧创作！</div><button class=button--pay data-post-id=2078742 data-author=846930 data-avatar=https://image.woshipm.com/wp-files/2019/03/R924qLB7G18mpvmmjVVk.jpg><svg width=13 height=16 class=svgIcon--use viewbox="0 0 13 16"><path d="M9.113 4.571C9.951 3.771 10.895 2.742 10.685 2.057 10.475 1.485 10.056.799 9.427.571 8.903.342 8.379.456 7.75.799 7.54.342 7.016.114 6.596-.001 5.863-.001 5.234.228 4.814.914 4.08.571 3.451.685 2.927 1.028 2.613 1.256 2.298 1.713 2.298 2.628 2.298 3.542 3.137 4.228 3.766 4.685 2.508 5.599-.218 7.885-.008 12.228-.218 15.656 2.613 15.999 2.613 15.999L10.371 15.999C11.314 15.885 12.991 14.971 12.991 12.571L12.991 12.228C13.201 7.771 10.371 5.371 9.113 4.571L9.113 4.571ZM8.932 11.835 6.94 11.835 6.94 13.207C6.94 13.435 6.731 13.549 6.521 13.549 6.311 13.549 6.102 13.435 6.102 13.207L6.102 11.835 4.11 11.835C3.9 11.835 3.795 11.606 3.795 11.378 3.795 11.149 3.9 10.921 4.11 10.921L6.102 10.921 6.102 10.121 4.949 10.121C4.739 10.121 4.634 9.892 4.634 9.664 4.634 9.435 4.739 9.206 4.949 9.206L5.892 9.206 4.739 7.95C4.634 7.835 4.739 7.606 4.949 7.492 5.158 7.378 5.368 7.264 5.473 7.378L6.521 8.635 7.674 7.264C7.779 7.149 7.989 7.264 8.198 7.378 8.408 7.492 8.408 7.721 8.408 7.835L7.15 9.321 8.094 9.321C8.303 9.321 8.408 9.549 8.408 9.778 8.408 10.007 8.303 10.235 8.094 10.235L6.94 10.235 6.94 11.035 8.932 11.035C9.142 11.035 9.247 11.264 9.247 11.493 9.247 11.606 9.037 11.835 8.932 11.835L8.932 11.835Z"></path></svg>赞赏</button></div></div><div class=footer><div class=copyright><blockquote><p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p><p>本文永久链接是：<a href=https://news.zfe.space/p/ed42.html>https://news.zfe.space/p/ed42.html</a></p></blockquote></div></div><div class=article-meta id=bottom><div class=new-meta-box><div class="new-meta-item date" itemprop=dateUpdated datetime=2022-09-26T15:13:13+00:00><a class=notlink><i class="fas fa-edit fa-fw" aria-hidden=true></i><p>更新于：2022年9月26日</p></a></div><div class="new-meta-item share -mob-share-list"><div class="-mob-share-list share-body"><a class=-mob-share-qq rel="external nofollow noopener noreferrer noopener" target=_blank href="http://connect.qq.com/widget/shareqq/index.html?url=https://news.zfe.space/p/ed42.html&title=PM技术课 _ 搜索引擎知多少？ - 小冰 RSSHub&pics=https://image.woshipm.com/wp-files/2019/03/gs7yWWmhheVR2CCfCyBg.jpg&summary="><img src=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png class=lazyload data-srcset=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a class=-mob-share-qzone rel="external nofollow noopener noreferrer noopener" target=_blank href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://news.zfe.space/p/ed42.html&title=PM技术课 _ 搜索引擎知多少？ - 小冰 RSSHub&pics=https://image.woshipm.com/wp-files/2019/03/gs7yWWmhheVR2CCfCyBg.jpg&summary="><img src=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png class=lazyload data-srcset=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a class=-mob-share-weibo rel="external nofollow noopener noreferrer noopener" target=_blank href="http://service.weibo.com/share/share.php?url=https://news.zfe.space/p/ed42.html&title=PM技术课 _ 搜索引擎知多少？ - 小冰 RSSHub&pics=https://image.woshipm.com/wp-files/2019/03/gs7yWWmhheVR2CCfCyBg.jpg&summary="><img src=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png class=lazyload data-srcset=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a></div></div></div></div><div class=prev-next><a class=prev href=/p/cec8.html><p class=title><i class="fas fa-chevron-left" aria-hidden=true></i>★★★★☆ 思琳 高定系列-不羁 Celine Reptile, 2019</p><p class=content>不刺鼻、巧克力感的皮革，很有质感，和胡椒、雪松一组合，居然很有趣，不错，烟熏感明显 闻多了感觉有点干燥和刺鼻</p></a><a class=next href=/p/a8ef.html><p class=title>加餐 _ 谈谈我的_三观_<i class="fas fa-chevron-right" aria-hidden=true></i></p><p class=content>世界观代表你是怎么看这个世界的，人生观代表你想成为什么样的人，价值观则代表你觉得什么对你来说更重要。</p></a></div></article></div><aside class=l_side><section class="widget toc-wrapper shadow desktop mobile" id=toc-div><header><i class="fas fa-list fa-fw" aria-hidden=true></i> <span class=name>本文目录</span></header><div class=content><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#toc-1><span class=toc-text>一、 初识搜索引擎</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>1. 搜索引擎简史</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#toc-2><span class=toc-text>二、什么是好的搜索引擎</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>1. 好的搜索引擎要快</span></a></li><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>2. 要查的准</span></a></li><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>3. 搜索引擎要具有稳定性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#toc-3><span class=toc-text>三、内容索引</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>关键词</span></a></li><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>倒排索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#toc-4><span class=toc-text>四、搜索结果排序</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>TF-IDF模型</span></a></li><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>大名鼎鼎的PageRank</span></a></li><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>其他排序方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#toc-5><span class=toc-text>五、 SEO与搜索引擎反作弊</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>SEO</span></a></li><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>搜索引擎反作弊</span></a></li><li class="toc-item toc-level-3"><a class=toc-link><span class=toc-text>猫鼠游戏</span></a></li></ol></li></ol></div></section></aside><script>
  window.pdata={}
  pdata.ispage=true;
  pdata.postTitle="PM技术课 _ 搜索引擎知多少？";
  pdata.commentPath="";
  pdata.commentPlaceholder="";
  // header 这里无论是否开启pjax都需要
  var l_header=document.getElementById("l_header");
  
  l_header.classList.add("show");
  
  
    // cover
    var cover_wrapper=document.querySelector('.cover-wrapper');
    
    cover_wrapper.id="none";
    cover_wrapper.style.display="none";
    
  
</script></div><footer class="footer clearfix"><br><br><div class=aplayer-container></div><br><div class=social-wrapper></div><div><p>博客内容遵循 <a target=_blank rel=noopener href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p></div><div><p><span id=lc-sv>本站总访问量为<span id=number><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden=true></i></span> 次</span> <span id=lc-uv>访客数为<span id=number><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden=true></i></span> 人</span></p></div>本站使用 <a href=https://github.com/volantis-x/hexo-theme-volantis/tree/4.3.1 target=_blank class=codename>Volantis</a> 作为主题<div class=copyright><p><a href="/">Copyright © 2017-2020 XXX</a></p></div></footer><a id=s-top class="fas fa-arrow-up fa-fw" href=javascript:void(0)></a></div></div><div><script>
/************这个文件存放不需要重载的全局变量和全局函数*********/
window.volantis={};
window.volantis.loadcss=document.getElementById("loadcss");
/******************** Pjax ********************************/
function VPjax(){
	this.list=[] // 存放回调函数
	this.start=()=>{
	  for(var i=0;i<this.list.length;i++){
		this.list[i].run();
	  }
	}
	this.push=(fn,name)=>{
		var f=new PjaxItem(fn,name);
		this.list.push(f);
	}
	// 构造一个可以run的对象
	function PjaxItem(fn,name){
		// 函数名称
		this.name = name || fn.name
		// run方法
		this.run=()=>{
			fn()
		}
	}
}
volantis.pjax={}
volantis.pjax.method={
	complete: new VPjax(),
	error: new VPjax(),
	send: new VPjax()
}
volantis.pjax={
	...volantis.pjax,
	push: volantis.pjax.method.complete.push,
	error: volantis.pjax.method.error.push,
	send: volantis.pjax.method.send.push
}
/********************脚本懒加载函数********************************/
// 已经加入了setTimeout
function loadScript(src, cb) {
	setTimeout(function() {
		var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
		var script = document.createElement('script');
		script.setAttribute('type','text/javascript');
		if (cb) script.onload = cb;
		script.setAttribute('src', src);
		HEAD.appendChild(script);
	});
}
//https://github.com/filamentgroup/loadCSS
var loadCSS = function( href, before, media, attributes ){
	var doc = window.document;
	var ss = doc.createElement( "link" );
	var ref;
	if( before ){
		ref = before;
	}
	else {
		var refs = ( doc.body || doc.getElementsByTagName( "head" )[ 0 ] ).childNodes;
		ref = refs[ refs.length - 1];
	}
	var sheets = doc.styleSheets;
	if( attributes ){
		for( var attributeName in attributes ){
			if( attributes.hasOwnProperty( attributeName ) ){
				ss.setAttribute( attributeName, attributes[attributeName] );
			}
		}
	}
	ss.rel = "stylesheet";
	ss.href = href;
	ss.media = "only x";
	function ready( cb ){
		if( doc.body ){
			return cb();
		}
		setTimeout(function(){
			ready( cb );
		});
	}
	ready( function(){
		ref.parentNode.insertBefore( ss, ( before ? ref : ref.nextSibling ) );
	});
	var onloadcssdefined = function( cb ){
		var resolvedHref = ss.href;
		var i = sheets.length;
		while( i-- ){
			if( sheets[ i ].href === resolvedHref ){
				return cb();
			}
		}
		setTimeout(function() {
			onloadcssdefined( cb );
		});
	};
	function loadCB(){
		if( ss.addEventListener ){
			ss.removeEventListener( "load", loadCB );
		}
		ss.media = media || "all";
	}
	if( ss.addEventListener ){
		ss.addEventListener( "load", loadCB);
	}
	ss.onloadcssdefined = onloadcssdefined;
	onloadcssdefined( loadCB );
	return ss;
};
</script><script>
  
  loadCSS("https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css", window.volantis.loadcss);
  
  
  
  
</script><script src=https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js></script><script>
  function pjax_fancybox() {
    $(".md .gallery").find("img").each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".md .gallery").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  function SCload_fancybox() {
    if ($(".md .gallery").find("img").length == 0) return;
    loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css", document.getElementById("loadcss"));
    loadScript('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
  };
  $(function () {
    SCload_fancybox();
  });
  function Pjax_SCload_fancybox(){
	if (typeof $.fancybox == "undefined") {
	 SCload_fancybox();
    } else {
	 pjax_fancybox();
    }
  }
  volantis.pjax.push(Pjax_SCload_fancybox)
  volantis.pjax.send(()=>{
      if (typeof $.fancybox != "undefined") {
        $.fancybox.close();    // 关闭弹窗
      }
  },'fancybox')
</script><script>
  function loadIssuesJS() {
    if ($(".md").find(".issues-api").length == 0) return;
	
	  loadScript('/js/issues.js');
	
  };
  $(function () {
    loadIssuesJS();
  });
  volantis.pjax.push(()=>{
	if (typeof IssuesAPI == "undefined") {
	  loadIssuesJS();
	}
  },"IssuesJS")
</script><script defer src=https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js></script><script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script><script>
  window.FPConfig = {
	delay: 0,
	ignoreKeywords: [],
	maxRPS: 5,
	hoverDelay: 25
  };
</script><script defer src=https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js></script><script src=/js/valine.js></script><script>
  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }
  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }
  function pjax_valine() {
    if(!document.querySelectorAll("#valine_container")[0])return;
    let pagePlaceholder = pdata.commentPlaceholder || "快来评论吧~";
    let path = pdata.commentPath;
    if (path.length == 0) {
      let defaultPath = '';
      path = defaultPath || decodeURI(window.location.pathname);
    }
    var valine = new Valine();
    valine.init(Object.assign({"path":null,"placeholder":"快来评论吧~","appId":null,"appKey":null,"meta":["nick","mail","link"],"requiredFields":["nick","mail"],"enableQQ":true,"recordIP":false,"avatar":"robohash","pageSize":10,"lang":"zh-cn","highlight":true,"mathJax":false}, {
      el: '#valine_container',
      path: path,
      placeholder: pagePlaceholder,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps,
    }))
  }
  $(function () {
    pjax_valine();
  });
  volantis.pjax.push(pjax_valine);
</script><script src=/js/app.js></script><script>
const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/";
const ROOT =  ("/" || "/").endsWith('/') ? ("/" || "/") : ("//" || "/" );

$('.input.u-search-input').one('focus',function(){
	
		loadScript('/js/search/hexo.js',setSearchService);
	
})

function listenSearch(){
  
    customSearch = new HexoSearch({
      imagePath: SearchServiceimagePath
    });
  
}
function setSearchService() {
	listenSearch();
	
}
</script><script defer>

  const LCCounter = {
    app_id: 'u9j57bwJod4EDmXWdxrwuqQT-MdYXbMMI',
    app_key: 'jfHtEKVE24j0IVCGHbvuFClp',
    custom_api_server: '',

    // 查询存储的记录
    getRecord(Counter, url, title) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({url})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {url, title: title, times: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    },

    // 发起自增请求
    increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    },

    // 构建自增请求体
    buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "times": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    },

    // 校验是否为有效的 UV
    validUV() {
      var key = 'LeanCloudUVTimestamp';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    },

    addCount(Counter) {
      var enableIncr = '' === 'true' && window.location.hostname !== 'localhost';
      enableIncr = true;
      var getterArr = [];
      var incrArr = [];
      // 请求 PV 并自增
      var pvCtn = document.querySelector('#lc-sv');
      if (pvCtn || enableIncr) {
        var pvGetter = this.getRecord(Counter, 'https://news.zfe.space' + '/#lc-sv', 'Visits').then((record) => {
          incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-sv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + 1;
              if (pvCtn) {
                pvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#lc-uv');
      if (uvCtn || enableIncr) {
        var uvGetter = this.getRecord(Counter, 'https://news.zfe.space' + '/#lc-uv', 'Visitors').then((record) => {
          var vuv = this.validUV();
          vuv && incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-uv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + (vuv ? 1 : 0);
              if (uvCtn) {
                uvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(uvGetter);
      }

      // 请求文章的浏览数，如果是当前页面就自增
      var allPV = document.querySelectorAll('#lc-pv');
      if (allPV.length > 0 || enableIncr) {
        for (i = 0; i < allPV.length; i++) {
          let pv = allPV[i];
          let title = pv.getAttribute('data-title');
          var url = 'https://news.zfe.space' + pv.getAttribute('data-path');
          if (url) {
            var viewGetter = this.getRecord(Counter, url, title).then((record) => {
              // 是当前页面就自增
              let curPath = window.location.pathname;
              if (curPath.includes('index.html')) {
                curPath = curPath.substring(0, curPath.lastIndexOf('index.html'));
              }
              if (pv.getAttribute('data-path') == curPath) {
                incrArr.push(this.buildIncrement(record.objectId));
              }
              if (pv) {
                var ele = pv.querySelector('#lc-pv #number');
                if (ele) {
                  if (pv.getAttribute('data-path') == curPath) {
                    ele.innerText = (record.times || 0) + 1;
                  } else {
                    ele.innerText = record.times || 0;
                  }
                  pv.style.display = 'inline';
                }
              }
            });
            getterArr.push(viewGetter);
          }
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && this.increment(Counter, incrArr);
        })
      }

    },


    fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': this.app_id,
            'X-LC-Key': this.app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      this.addCount(Counter);
    },

    refreshCounter() {
      var api_server = this.app_id.slice(-9) !== '-MdYXbMMI' ? this.custom_api_server : `https://${ this.app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;
      if (api_server) {
        this.fetchData(api_server);
      } else {
        fetch('https://app-router.leancloud.cn/2/route?appId=' + this.app_id)
          .then(resp => resp.json())
          .then(({api_server}) => {
            this.fetchData('https://' + api_server);
          });
      }
    }

  };

  LCCounter.refreshCounter();

  document.addEventListener('pjax:complete', function () {
    LCCounter.refreshCounter();
  });
</script><script>
const rootElement = document.documentElement;
const darkModeStorageKey = "user-color-scheme";
const rootElementDarkModeAttributeName = "data-user-color-scheme";

const setLS = (k, v) => {
    localStorage.setItem(k, v);
};

const removeLS = (k) => {
    localStorage.removeItem(k);
};

const getLS = (k) => {
    return localStorage.getItem(k);
};

const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};

const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};

const validColorModeKeys = {
  dark: true,
  light: true,
};

const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);

  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};

const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};

/**
 * get target mode
 */
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);

  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};

/**
 * bind click event for toggle button
 */
var btn=$("#wrapper .toggle-mode-btn,#rightmenu-wrapper .toggle-mode-btn");
function bindToggleButton() {
    btn.on('click',(e) => {
      const mode = toggleCustomDarkMode();
      applyCustomDarkModeSettings(mode);
    });
}

applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", bindToggleButton);
volantis.pjax.push(bindToggleButton);
volantis.pjax.send(()=>{
	btn.unbind('click');
},'toggle-mode-btn-unbind');
</script><script>
function listennSidebarTOC() {
  const navItems = document.querySelectorAll(".toc li");
  if (!navItems.length) return;
  const sections = [...navItems].map((element) => {
    const link = element.querySelector(".toc-link");
    const target = document.getElementById(
      decodeURI(link.getAttribute("href")).replace("#", "")
    );
    link.addEventListener("click", (event) => {
      event.preventDefault();
      window.scrollTo({
		top: target.offsetTop + 100,
		
		behavior: "smooth"
		
	  });
    });
    return target;
  });

  function activateNavByIndex(target) {
    if (target.classList.contains("active-current")) return;

    document.querySelectorAll(".toc .active").forEach((element) => {
      element.classList.remove("active", "active-current");
    });
    target.classList.add("active", "active-current");
    let parent = target.parentNode;
    while (!parent.matches(".toc")) {
      if (parent.matches("li")) parent.classList.add("active");
      parent = parent.parentNode;
    }
  }

  function findIndex(entries) {
    let index = 0;
    let entry = entries[index];
    if (entry.boundingClientRect.top > 0) {
      index = sections.indexOf(entry.target);
      return index === 0 ? 0 : index - 1;
    }
    for (; index < entries.length; index++) {
      if (entries[index].boundingClientRect.top <= 0) {
        entry = entries[index];
      } else {
        return sections.indexOf(entry.target);
      }
    }
    return sections.indexOf(entry.target);
  }

  function createIntersectionObserver(marginTop) {
    marginTop = Math.floor(marginTop + 10000);
    let intersectionObserver = new IntersectionObserver(
      (entries, observe) => {
        let scrollHeight = document.documentElement.scrollHeight + 100;
        if (scrollHeight > marginTop) {
          observe.disconnect();
          createIntersectionObserver(scrollHeight);
          return;
        }
        let index = findIndex(entries);
        activateNavByIndex(navItems[index]);
      },
      {
        rootMargin: marginTop + "px 0px -100% 0px",
        threshold: 0,
      }
    );
    sections.forEach((element) => {
      element && intersectionObserver.observe(element);
    });
  }
  createIntersectionObserver(document.documentElement.scrollHeight);
}

document.addEventListener("DOMContentLoaded", listennSidebarTOC);
document.addEventListener("pjax:success", listennSidebarTOC);
</script><script src=https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js></script><script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）

      volantis.$switcher.removeClass('active'); // 关闭移动端激活的搜索框
      volantis.$header.removeClass('z_search-open'); // 关闭移动端激活的搜索框
      volantis.$wrapper.removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      volantis.$topBtn.unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
	  // 使用 volantis.pjax.send 方法传入pjax:send回调函数 参见layout/_partial/scripts/global.ejs
	  volantis.pjax.method.send.start();
    });

    document.addEventListener('pjax:complete', function () {
      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
		// 使用 volantis.pjax.push 方法传入重载函数 参见layout/_partial/scripts/global.ejs
		volantis.pjax.method.complete.start();
      } catch (e) {
        console.log(e);
      }
    });

    document.addEventListener('pjax:error', function (e) {
	  // 使用 volantis.pjax.error 方法传入pjax:error回调函数 参见layout/_partial/scripts/global.ejs
	  volantis.pjax.method.error.start();
      window.location.href = e.triggerElement.href;
    });
</script></div></body></html>